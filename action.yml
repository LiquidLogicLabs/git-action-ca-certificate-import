name: 'CA Certificate Import'
description: 'Install custom SSL/TLS certificates for build environments'
author: 'LiquidLogicLabs'

branding:
  icon: 'shield'
  color: 'blue'

inputs:
  certificate:
    description: |
      Certificate source: auto-detects file path, URL, or inline content.
      - URL: starts with http:// or https:// (e.g., 'https://pki.company.com/ca.crt')
      - File path: relative or absolute path to certificate file (e.g., 'certs/ca.crt')
      - Inline: contains -----BEGIN CERTIFICATE----- markers (e.g., from secrets)
    required: true
  
  certificate-name:
    description: 'Name for the certificate file (auto-generated if not specified)'
    required: false
    default: ''
  
  verbose:
    description: 'Enable verbose debug logging. Also enabled when ACTIONS_STEP_DEBUG=true.'
    required: false
    default: 'false'
  
  generate-buildkit:
    description: 'Generate buildkit.toml configuration file with CA certificate settings'
    required: false
    default: 'false'
  
  buildkit-runtime:
    description: 'Container runtime for BuildKit (e.g., "io.containerd.runc.v2"). Leave empty to omit runtime configuration'
    required: false
    default: ''

outputs:
  certificate-path:
    description: 'Path where the certificate was installed'
    value: ${{ steps.install-cert.outputs.certificate-path }}
  
  certificate-name:
    description: 'Name of the installed certificate file'
    value: ${{ steps.install-cert.outputs.certificate-name }}
  
  buildkit-path:
    description: 'Path to the generated buildkit.toml file (only set if generate-buildkit is true)'
    value: ${{ steps.install-cert.outputs.buildkit-path }}

runs:
  using: 'composite'
  steps:
    - name: Install certificate
      id: install-cert
      shell: bash
      run: ${{ github.action_path }}/install-certificate.sh
      env:
        INPUT_CERTIFICATE: ${{ inputs.certificate }}
        INPUT_CERTIFICATE_NAME: ${{ inputs.certificate-name }}
        INPUT_VERBOSE: ${{ inputs.verbose == 'true' || env.ACTIONS_STEP_DEBUG == 'true' }}
        INPUT_GENERATE_BUILDKIT: ${{ inputs.generate-buildkit }}
        INPUT_BUILDKIT_RUNTIME: ${{ inputs.buildkit-runtime }}

