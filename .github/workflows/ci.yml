name: CI

on:
  push:
    branches: ['**']
  pull_request:
    branches: ['**']
  workflow_call:  # Allow CI to be called by release workflow
  workflow_dispatch:  # Allow manual triggering

permissions:
  contents: read
  pull-requests: read

jobs:
  test:
    # Always run when called via workflow_call or workflow_dispatch, skip only on direct tag pushes
    if: github.event_name == 'workflow_call' || github.event_name == 'workflow_dispatch' || (github.event_name == 'push' && github.ref_type != 'tag')
    uses: ./.github/workflows/test.yml
    # test.yml runs: all tests for composite action